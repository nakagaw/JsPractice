<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>JSの練習とかもろもろやる</title>
<style type="text/css">
*{ margin: 0; padding: 0}
#wrap {
	position: relative;
}
header {
	width: 100%;
	height: 300px;
	background-color: blue;
}
footer {
	clear: both;
	width: 100%;
	height: 300px;
	background-color: red;
}
.pageTop {
	width: 40px;
	height: 40px;
	background-color: blue;
	float: right;

}
#content {
	width: 300px;
	height: 2000px;
	margin: 0 auto;
	background-color: #ddd;
}
#linkTab {
	position: absolute;
	right: 0;
	z-index: 99;
	height: 200px;
	width: 60px;
	background-color: #111;
}

#data {
	position: fixed;
	z-index: 999;
	color: #fff;
	background-color: red;
}
#data2 {
	position: fixed;
	z-index: 999;
	top: 60px;
	color: #fff;
	background-color: blue;
}
</style>
<script src="./js/jquery-2.1.1.min.js"></script>
<!--script src="./js/jquery-1.11.1.js"></script-->
<script src="./js/main.js"></script>
<script type="text/javascript">
$(function () {
	$(window).scroll(scrollFunc);
});

function scrollFunc(eo){
	var win   =$(window);
	var page   =$(document);
	var ctWiz = $('#content').width();
	var tab = $("#linkTab");

	var pos1 = $("header").outerHeight() ; //ヘッダーの厚み位置
	var pos2 = (win.height() /2) - (tab.outerHeight() /2); //中央位置
	var pos3 = $("footer").outerHeight()+$(".pageTop").outerHeight(); //フッターの厚み＋余白位置
	var pos4 = (win.height()-pos1-tab.height()) / 2; //ヘッダーの厚み位置からスクロールして中央位置に来るまでの距離
	var pos5 = (win.height()-pos3-tab.height()) / 2; //ヘッダーの厚み位置からスクロールして中央位置に来るまでの距離

	var sPos = win.scrollTop() + win.height(); //スクロールした位置（０〜ページ最大長までで）
	var posS = page.height()  - sPos;

	$('#data').text('スクロール位置：' + sPos+'｜ページ長さ：' + page.height() +'｜コンテンツ幅：' + ctWiz+'｜ウィンドウ横幅：' + win.width()+'｜ウィンドウ縦幅：' + win.height()+'｜タブの高さ：' + tab.height());
	$('#data2').text(pos5 +  'doc-位置：' + posS +'｜ポジ１：' + pos1 +'｜ポジ２：' + pos2+'｜ポジ３：' + pos3 + '｜ポジ４：' + pos4);

/*
650-225
286
425-340
tab + pos2
	//それ以外は真ん中
	if ( sPos > pos4) {
		tab.css({
			"position": "fixed",
			"top": pos2,
			"bottom": ""
		});
	} else {
		//ヘッダーにいったとき
		if (posS<= 115) {
			tab.css({
				"position": "absolute",
				"top": "",
				"bottom": pos3
			});
		}
		//ヘッダーにいったとき
		else {
			tab.css({
				"position": "absolute",
				"top": pos1,
				"bottom": ""
			});
		}
	}
*/

	if (  posS<= 115) {
		tab.css({
			"position": "absolute",
			"top": "",
			"bottom": pos3
		});
	}
	//ヘッダーにいったとき
	else {
		tab.css({
		"position": "fixed",
		"top": pos2,
		"bottom": ""
		});
	}
}
//これは省略型？ http://www.jquerystudy.info/reference/events/scroll.html
$(window).scroll(function (){
});


(function($){

/*
	$.fn.linkTab = function(container){

			var self = $(this),
			container = $(container);

			$(window).bind("scroll", function() {
				var docHeight = $(document).height();
				var docWidth = $('#content').width();
				var winHeight = $(window).height();
				var winWidth = $(window).width();

				//ウィンドウの高さ+スクロールされた距離
				var scrollPosition = winHeight + $(window).scrollTop();
				//ヘッダの厚みを取得
				var headHeight = $("header").outerHeight() + 35;
				//フッタの厚みにページTOP足した値を取得
				var footHeight = $("footer").outerHeight() + 100;
				//var topPosition = winHeight / 2;

console.log(scrollPosition);
console.log(docHeight);
console.log(footHeight);

				//縦　ドキュメントの高さ-スクロールされた距離を比較してフッタの高さよりも小さくなったら
				if (scrollPosition >= docHeight-footHeight) {
					self.css({
						"position": "absolute",
						"top": "",
						"bottom": footHeight
					});
				} // 入っときはヘッダーのたかさ
				else if (scrollPosition <= winHeight + 20) {
					self.css({
						"position": "absolute",
						"top": headHeight,
						"bottom": ""
					});
				}
				else if (scrollPosition <= docHeight-headHeight) {
					self.css({
						"position": "fixed",
						"top": headHeight,
						"bottom": ""
					});
				}//それ以外は真ん中
				else {
					self.css({
						"position": "fixed",
						"top": topPosition,
						"bottom": ""
					});
				}
			});
			$(window).scroll();
	};
*/
})(jQuery);

</script>
</head>
<body>
<div id="data"></div>
<div id="data2"></div>
<div id="wrap">
<header></header>
<div id="content">

	<div id="linkTab">

	</div>
</div>
<p class="pageTop"></p>
<footer></footer>
</div>
</body>
</html>